@{
    ViewData["Title"] = "Gerenciar Anúncio";
}

@section Styles {
    <link rel="stylesheet" href="~/css/produto/produto-cadastro.css" asp-append-version="true" />
}

<section class="manage-ad-section container">
    <form asp-action="SalvarAnuncio" method="post" enctype="multipart/form-data" class="space-y-6">
        <ul class="nav nav-tabs" id="adFormTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="details-tab" data-bs-toggle="tab"
                        data-bs-target="#item-details" type="button" role="tab"
                        aria-controls="item-details" aria-selected="true">
                    Detalhes do Item
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="images-tab" data-bs-toggle="tab"
                        data-bs-target="#item-images" type="button" role="tab"
                        aria-controls="item-images" aria-selected="false">
                    Imagens do Item
                </button>
            </li>
        </ul>

        <div class="tab-content" id="adFormTabContent">
            <!-- Detalhes -->
            <div class="tab-pane fade show active" id="item-details" role="tabpanel" aria-labelledby="details-tab">
                <div class="grid md:grid-cols-4">
                    <div>
                        <label for="Nome" class="form-label">Nome do Produto</label>
                        <input type="text" id="Nome" name="Nome"
                               class="form-control-custom" placeholder="Ex: Camiseta, Pacote de Arroz" required />
                    </div>
                    <div class="grid grid-cols-2 gap-x-6">
                        <div>
                            <label for="Condicao" class="form-label">Condição</label>
                            <select id="Condicao" name="Condicao" class="form-control-custom">
                                <option>Novo</option>
                                <option>Usado – Bom</option>
                                <option>Usado – Regular</option>
                                <option>Usado – Ruim</option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <label for="Validade" class="form-label">Validade</label>
                                <input type="date" id="Validade" name="Validade"
                                       class="form-control-custom" />
                            </div>
                            <div class="col-md-4">
                                <label for="Quantidade" class="form-label">Quantidade</label>
                                <input type="number" id="Quantidade" name="Quantidade" min="1"
                                       class="form-control-custom" placeholder="Mínimo 1" required />
                            </div>
                            <div class="col-md-4">
                                <label for="Peso" class="form-label">Peso (kg)</label>
                                <input type="number" step="0.1" id="Peso" name="Peso" min="0"
                                       class="form-control-custom" placeholder="Ex: 0.5" required />
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="Categoria" class="form-label">Categoria</label>
                        <select id="Categoria" name="Categoria" class="form-control-custom">
                            <option>Alimentos</option>
                            <option>Roupas</option>
                            <option>Higiene</option>
                            <option>Móveis</option>
                            <option>Eletrônicos</option>
                            <option>Brinquedos</option>
                            <option>Outros</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label for="Descricao" class="form-label">Descrição</label>
                    <textarea id="Descricao" name="Descricao" rows="4"
                              class="form-control-custom"
                              placeholder="Forneça uma descrição detalhada…" required>
          </textarea>
                </div>
            </div>

            <!-- Imagens -->
            <div class="tab-pane fade" id="item-images" role="tabpanel" aria-labelledby="images-tab">
                <div class="image-upload-container" id="dropZone">
                    <label for="ImagemPrincipal" class="upload-placeholder">
                        <i class="fas fa-cloud-upload-alt"></i>
                        Clique ou arraste e solte uma imagem aqui
                    </label>
                    <input type="file" id="ImagemPrincipal" name="ImagemPrincipal"
                           accept="image/*" onchange="previewImagemPrincipal(event)" required />
                </div>
                <div class="image-preview-wrapper">
                    <img id="previewImagem" src="#" alt="Pré-visualização"
                         class="image-preview hidden" />
                </div>
                <div class="mt-4 text-center">
                    <a href="/anuncio/imagens" class="form-label">
                        <i class="fas fa-plus-circle"></i> Adicionar Mais Imagens
                    </a>
                </div>
            </div>
        </div>

        <div class="flex justify-center">
            <button class="button">Voltar</button>
            <button type="submit" class="submit-button">Salvar Anúncio</button>
        </div>
    </form>
</section>

@section Scripts {
    <script>
        // Preview de imagem
        function previewImagemPrincipal(event) {
          const file = event.target.files[0],
                preview = document.getElementById('previewImagem');
          if (file) {
            const reader = new FileReader();
            reader.onload = e => {
              preview.src = e.target.result;
              preview.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
          }
        }

        // Drag & Drop UX
        const dropZone = document.getElementById('dropZone');
        ['dragenter','dragover'].forEach(evt =>
          dropZone.addEventListener(evt, e => {
            e.preventDefault(); dropZone.classList.add('dragover');
          })
        );
        ['dragleave','drop'].forEach(evt =>
          dropZone.addEventListener(evt, e => {
            e.preventDefault(); dropZone.classList.remove('dragover');
            if (evt === 'drop') {
              const dt = e.dataTransfer, file = dt.files[0];
              document.getElementById('ImagemPrincipal').files = dt.files;
              previewImagemPrincipal({ target: { files: [file] } });
            }
          })
        );
    </script>
}
